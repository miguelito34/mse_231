---
title: "tweet_analysis"
author: "Michael Spencer"
date: "10/7/2019"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Setup

### Libraries
```{r}
library(tidyverse)
```

###  Parameters
```{r}
all_tweets_pathname <- "all_tweets_clean.tsv"
filtered_tweets_pathname <- "filtered_tweets_clean.tsv"
female_names_url <- "https://5harad.com/mse125/assets/hw1/female_names.tsv.gz"
male_names_url <- "https://5harad.com/mse125/assets/hw1/male_names.tsv.gz"
```

## Load Data
```{r}
all_tweets <-
  all_tweets_pathname %>%
  read_tsv(quote = " ")

filtered_tweets <-
  filtered_tweets_pathname %>% 
  read_tsv()

female_names <-
  female_names_url %>% 
  read_tsv()

male_names <-
  male_names_url %>% 
  read_tsv()
```

## Functions

### find_gender function

This function will make an educated guess on the 
```{r}

```


## Analysis

### Prep Gender Data

Assigning twitter users to a given gender using only their names requires a
statistical strategy. In the code below, I'll do just that by determining, for
a given name, whether it is more likely to be male or female. Much of this
computation will be done in the following steps once we identify the users
first name, but the first step is to identify the range of years we would like
to use before aggregating the total count of each name for each gender.

Let's assume that no twitter user is older than 90 (let's face it, not many 90
year olds are tech savvy). Let's also assume that no one younger than 5 is
Tweeting.

This means our Twitter users are between 5 and 90, and were thus born between
1928 and 2014. I'll filter out data to reflect that, while simultaneously
aggregating the names and making them lowercase (to ensure our matching of
twitter users' names is robust to capitalization).
```{r}
male_names <-
  male_names %>% 
  filter(year >= 1928 & year <= 2014) %>% 
  mutate(name = name %>% str_to_lower()) %>% 
  group_by(name) %>% 
  summarise(total = sum(count, na.rm = TRUE))

female_names <-
  female_names %>% 
  filter(year >= 1928 & year <= 2014) %>% 
  mutate(name = name %>% str_to_lower()) %>% 
  group_by(name) %>% 
  summarise(total = sum(count, na.rm = TRUE))
```

### Prep Tweet Data

The tweet data needs some cleaning. Here we do simple string manipulation to
try and clear the names of any numbers under the assumption that first names
only include alpha characters.
```{r}
filtered_tweets %>% 
  head(100) %>% 
  mutate_if(
    is.character, 
    str_replace_all,
    pattern = "[^[:alpha:]+[:space:]]", 
    replacement = ""
  ) %>% 
  mutate_if(
    is.character,
    str_extract,
    pattern = "^[:alpha:]+"
  ) %>%
  mutate_if(
    is.character,
    str_to_lower
  ) %>% 
  View()
```

